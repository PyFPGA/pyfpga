#
# Copyright (C) 2020-2024 Rodrigo A. Melo
#
# SPDX-License-Identifier: GPL-3.0-or-later
#

set -e

DOCKER="docker run --rm -v $HOME:$HOME -w $PWD"

{% if SYN %}
$DOCKER hdlc/ghdl:yosys /bin/bash -c "
{{ PRESYN }}
{{ VHDLS }}
yosys -Q -m ghdl -p '
{% if INCLUDES %}
verilog_defaults -add {{ INCLUDES }}
{% endif %}
{% if DEFINES %}
verilog_defines {{ DEFINES }}
{% endif %}
{{ VLOGS }}
{{ SLOGS }}
{% if PARAMS %}
chparam {{ PARAMS }} {{ TOP }}
{% endif %}
synth -top {{ TOP }}
'
{{ POSTSYN }}
"
{% endif %}

{% if PAR %}
{{ PREPAR }}

{{ POSTPAR }}
{% endif %}

{% if BIT %}
{{ PREBIT }}

{{ POSTBIT }}
{% endif %}
